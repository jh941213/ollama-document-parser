# ğŸ“„ ollamaparser

**ê³ ê¸‰ PDF ë¬¸ì„œ íŒŒì‹± ì‹œìŠ¤í…œ** â€” Layout Detection + OCR + Vision Language Model(VLM)ì„ ê²°í•©í•˜ì—¬ PDFë¥¼ ì§€ëŠ¥í˜• êµ¬ì¡°í™” ë¬¸ì„œë¡œ ë³€í™˜

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

ë³µì¡í•œ ë ˆì´ì•„ì›ƒì˜ PDF ë¬¸ì„œë¥¼ ìë™ìœ¼ë¡œ ì´í•´í•˜ê³  **êµ¬ì¡°í™”ëœ Markdown**ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

- ğŸ“ **ì •í™•í•œ ë ˆì´ì•„ì›ƒ ë¶„ì„** â€” YOLO ê¸°ë°˜ ìš”ì†Œ ê°ì§€
- ğŸ”¤ **ê³ í’ˆì§ˆ í…ìŠ¤íŠ¸ ì¶”ì¶œ** â€” ë”¥ëŸ¬ë‹ OCR
- ğŸ¨ **ì´ë¯¸ì§€ ìë™ í•´ì„** â€” ì°¨íŠ¸/ê·¸ë˜í”„ ë¶„ì„
- ğŸ§  **ì§€ëŠ¥í˜• ì½ê¸° ìˆœì„œ** â€” ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì„œ íë¦„
- âš¡ **ê³ ì„±ëŠ¥ ë³‘ë ¬ ì²˜ë¦¬** â€” ThreadPoolExecutor í™œìš©

---

## âš™ï¸ í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜ (5ë‹¨ê³„)

### 1ï¸âƒ£ **ë ˆì´ì•„ì›ƒ ê°ì§€ (Layout Detection)**

```
PDF í˜ì´ì§€ ì´ë¯¸ì§€ â†’ DocLayout-YOLO â†’ ìš”ì†Œ ë¶„ë¥˜ ë° ìœ„ì¹˜ íŒŒì•…
```

**ì—­í• :**
- ê° í˜ì´ì§€ì—ì„œ ì˜ë¯¸ìˆëŠ” ëª¨ë“  ìš”ì†Œ ìë™ ê°ì§€
- ê°ì§€ ìš”ì†Œ: ì œëª©, ë³¸ë¬¸, í‘œ, ì°¨íŠ¸, ì´ë¯¸ì§€, ì£¼ì„, ìº¡ì…˜ ë“±
- ê° ìš”ì†Œì˜ **Bounding Box(ì¢Œí‘œ), íƒ€ì…, ì‹ ë¢°ë„** ì‚°ì¶œ

**ì¶œë ¥ ì˜ˆì‹œ:**
```json
{
  "type": "figure",
  "bbox": {"left": 100, "top": 200, "right": 500, "bottom": 400},
  "confidence": 0.95
}
```

---

### 2ï¸âƒ£ **ì½ê¸° ìˆœì„œ ì¶”ë¡  (Reading Order)**

```
ê°ì§€ëœ ìš”ì†Œ ìœ„ì¹˜ â†’ K-means ì»¬ëŸ¼ í´ëŸ¬ìŠ¤í„°ë§ â†’ ìì—°ìŠ¤ëŸ¬ìš´ ìˆœì„œ ê²°ì •
```

**ì•Œê³ ë¦¬ì¦˜:**
1. **Yì¢Œí‘œ ê¸°ë°˜ í´ëŸ¬ìŠ¤í„°ë§** â€” í–‰(row) ìë™ ê°ì§€
2. **í–‰ ë‚´ ì •ë ¬** â€” Xì¢Œí‘œë¡œ ì¢Œâ†’ìš° ì •ë ¬
3. **í–‰ ê°„ ì •ë ¬** â€” ìœ„â†’ì•„ë˜ ìˆœì„œ í™•ì •

**ë‹¤ë‹¨ ë ˆì´ì•„ì›ƒ ì²˜ë¦¬:**
```
ì‹ ë¬¸/ì¡ì§€ 2ë‹¨ ë ˆì´ì•„ì›ƒ:
[ì™¼ìª½ ìƒë‹¨] â†’ [ì˜¤ë¥¸ìª½ ìƒë‹¨] â†’ [ì™¼ìª½ í•˜ë‹¨] â†’ [ì˜¤ë¥¸ìª½ í•˜ë‹¨]
```

---

### 3ï¸âƒ£ **í…ìŠ¤íŠ¸ ì¶”ì¶œ (OCR)**

```
ì´ë¯¸ì§€ ì˜ì—­ â†’ DeepSeek-OCR (Ollama) â†’ ê³ ì •í™•ë„ í…ìŠ¤íŠ¸
```

**íŠ¹ì§•:**
- **í•œê¸€/ì˜ë¬¸ í˜¼í•©** ë¬¸ì„œ ì™„ë²½ ì§€ì›
- **í• ë£¨ì‹œë„¤ì´ì…˜ í•„í„°ë§** â€” ë¶€ì •í™•í•œ OCR ê²°ê³¼ ìë™ ì œê±°
- **í¬ë§· ìœ ì§€** â€” í‘œ, ì½”ë“œ ë¸”ë¡ ë“± ë§ˆí¬ë‹¤ìš´ í¬ë§· ë³´ì¡´

---

### 4ï¸âƒ£ **ì‹œê° ì½˜í…ì¸  í•´ì„ (VLM)**

```
ì°¨íŠ¸/ê·¸ë˜í”„ ì´ë¯¸ì§€ â†’ Gemma3/Qwen3-VL â†’ ìë™ í•´ì„ ë° ìš”ì•½
```

**ë¶„ì„ í•­ëª©:**
- **ìš”ì•½** â€” ì´ë¯¸ì§€ì˜ í•µì‹¬ ë‚´ìš© ìš”ì•½
- **í•µì‹¬ í¬ì¸íŠ¸** â€” ì£¼ìš” ìˆ˜ì¹˜ ë° íŠ¸ë Œë“œ
- **ì£¼ì˜ì‚¬í•­** â€” íŠ¹ë³„íˆ ì£¼ëª©í•  ì 

**ì¶œë ¥ êµ¬ì¡°:**
```
- ìš”ì•½: ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ì€ 2022ë…„ ì •ì ì„ ì°ì€ í›„ í•˜ë½ ì¶”ì„¸...
- í•µì‹¬:
  1. 2022ë…„ 8% ì´ˆê³¼
  2. 2024ë…„ 3% ìˆ˜ì¤€ ì˜ˆìƒ
- ì£¼ì˜: ë¯¸êµ­ ì •ì±… ë³€í™” ì£¼ì‹œ í•„ìš”
```

---

### 5ï¸âƒ£ **ë³‘ë ¬ ì²˜ë¦¬ (Parallel Execution)**

```
ì—¬ëŸ¬ ìš”ì†Œì˜ OCR/VLM ì‘ì—… â†’ ThreadPoolExecutorë¡œ ë™ì‹œ ì‹¤í–‰
```

**ì„¸ ê°€ì§€ ì‹¤í–‰ ëª¨ë“œ:**

| ëª¨ë“œ | íŠ¹ì§• | ì‚¬ìš© ì‹œì  |
|------|------|----------|
| **Parallel** | ëª¨ë“  OCR/VLM ë™ì‹œ ì‹¤í–‰ | ê³ ì† ì²˜ë¦¬ í•„ìš”, ì¶©ë¶„í•œ ë©”ëª¨ë¦¬ |
| **Grouped** | OCR ì™„ë£Œ í›„ VLM | ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± ìš°ì„  |
| **Interleaved** | ìš”ì†Œë³„ OCRâ†’VLM ìˆœì°¨ | ê· í˜•ì¡íŒ ì„±ëŠ¥ |

---

## ğŸš€ í•µì‹¬ ê¸°ëŠ¥ ìš”ì•½

âœ… **ì •í™•í•œ ë ˆì´ì•„ì›ƒ ë¶„ì„** â€” DocLayout-YOLOë¡œ í…Œì´ë¸”, í…ìŠ¤íŠ¸, ì°¨íŠ¸, ì´ë¯¸ì§€ ìë™ ê°ì§€
âœ… **ê³ í’ˆì§ˆ OCR** â€” DeepSeek-OCR (Ollama) ê¸°ë°˜ í•œê¸€/ì˜ë¬¸ í˜¼í•© ë¬¸ì„œ ì§€ì›
âœ… **ì§€ëŠ¥í˜• VLM í•´ì„** â€” Gemma3/Qwen3-VLë¡œ ì°¨íŠ¸Â·ê·¸ë¦¼Â·ë„í‘œ ìë™ ë¶„ì„ ë° ìš”ì•½
âœ… **ìì—°ìŠ¤ëŸ¬ìš´ ì½ê¸° ìˆœì„œ** â€” K-means ê¸°ë°˜ ë‹¤ë‹¨ ë ˆì´ì•„ì›ƒ ì²˜ë¦¬
âœ… **ê³ ì„±ëŠ¥ ë³‘ë ¬ ì²˜ë¦¬** â€” ThreadPoolExecutorë¡œ OCR/VLM ì‘ì—… ë™ì‹œ ì‹¤í–‰

---

## ğŸ“Š ì „ì²´ ì²˜ë¦¬ íë¦„

```
PDF íŒŒì¼
  â”‚
  â”œâ”€â–º [Step 1] PDF ë Œë”ë§
  â”‚   â””â”€ pypdfium2ë¡œ í˜ì´ì§€ ì´ë¯¸ì§€ ìƒì„±
  â”‚   â””â”€ í…ìŠ¤íŠ¸ ë ˆì´ì–´ ì¶”ì¶œ
  â”‚
  â”œâ”€â–º [Step 2] ë ˆì´ì•„ì›ƒ ê°ì§€
  â”‚   â””â”€ DocLayout-YOLOë¡œ ìš”ì†Œ ê°ì§€
  â”‚   â””â”€ BBox + íƒ€ì… + ì‹ ë¢°ë„ ì‚°ì¶œ
  â”‚
  â”œâ”€â–º [Step 3] ê°ì§€ ê²°ê³¼ í•„í„°ë§
  â”‚   â””â”€ ì‹ ë¢°ë„ ì„ê³„ê°’ í•„í„°ë§
  â”‚   â””â”€ IoU ê¸°ë°˜ ì¤‘ë³µ ì œê±°
  â”‚
  â”œâ”€â–º [Step 4] ì½ê¸° ìˆœì„œ ì¶”ë¡ 
  â”‚   â””â”€ K-means í´ëŸ¬ìŠ¤í„°ë§
  â”‚   â””â”€ ìì—°ìŠ¤ëŸ¬ìš´ ìˆœì„œ ê²°ì •
  â”‚
  â”œâ”€â–º [Step 5] OCR/VLM ì²˜ë¦¬ (ë³‘ë ¬/ìˆœì°¨)
  â”‚   â”œâ”€ OCR: í…ìŠ¤íŠ¸ ì˜ì—­ ì¶”ì¶œ
  â”‚   â”œâ”€ VLM: ì´ë¯¸ì§€ ë¶„ì„
  â”‚   â””â”€ Ollama ì„œë²„ í˜¸ì¶œ
  â”‚
  â”œâ”€â–º [Step 6] í…ìŠ¤íŠ¸ ì •ì œ
  â”‚   â””â”€ í• ë£¨ì‹œë„¤ì´ì…˜ í•„í„°ë§
  â”‚   â””â”€ HTML â†’ Markdown ë³€í™˜
  â”‚
  â””â”€â–º [Step 7] ì¶œë ¥ ìƒì„±
      â”œâ”€ out.md (ë§ˆí¬ë‹¤ìš´)
      â”œâ”€ out.meta.json (ë©”íƒ€ë°ì´í„°)
      â”œâ”€ pages/ (ë Œë”ë§ ì´ë¯¸ì§€)
      â”œâ”€ crops/ (VLMìš© ì´ë¯¸ì§€)
      â””â”€ detections/ (ê°ì§€ ê²°ê³¼ ì‹œê°í™”)
```

---

## ğŸ“‹ ì‹¤ì œ ì²˜ë¦¬ ì˜ˆì‹œ

### ë ˆì´ì•„ì›ƒ ê°ì§€ ê²°ê³¼

DocLayout-YOLOê°€ PDF í˜ì´ì§€ì—ì„œ ìë™ìœ¼ë¡œ ìš”ì†Œë¥¼ ê°ì§€í•œ ê²°ê³¼:

![Detection Example](examples/detection_example.jpg)

**ê°ì§€ëœ ìš”ì†Œë“¤:**
- `title` (0.93) - í˜ì´ì§€ ì œëª©
- `plain_text` (0.96) - ë³¸ë¬¸ í…ìŠ¤íŠ¸
- `figure` (0.96, 0.82, 0.81) - ì°¨íŠ¸/ê·¸ë˜í”„ ì˜ì—­
- `figure_caption` (0.86, 0.68, 0.58) - ê·¸ë¦¼ ìº¡ì…˜
- `table_footnote` (0.82) - ì¶œì²˜/ê°ì£¼
- `abandon` (0.65, 0.93, 0.90) - ë¬´ì‹œí•  ì˜ì—­ (ë¡œê³ , í˜ì´ì§€ ë²ˆí˜¸ ë“±)

### VLM ì°¨íŠ¸ í•´ì„

#### ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ ì¶”ì´ ì°¨íŠ¸
![Inflation Chart](examples/crop_chart_inflation.jpg)

**VLM í•´ì„ ê²°ê³¼:**
```
- ìš”ì•½: ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ì€ 2022ë…„ ì •ì ì„ ì°ì€ í›„ ë‘”í™” ì¶”ì„¸ì´ë©°, 
       2025ë…„ê¹Œì§€ í•˜í–¥ ì•ˆì •í™”ë  ê²ƒìœ¼ë¡œ ì „ë§ë©ë‹ˆë‹¤.
- í•µì‹¬:
    1. 2022ë…„ ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ì€ 8%ë¥¼ ë„˜ëŠ” ìµœê³ ì ì„ ê¸°ë¡
    2. 2024ë…„ ì´í›„ ì¸í”Œë ˆì´ì…˜ì€ 3% ìˆ˜ì¤€ìœ¼ë¡œ í•˜ë½ ì˜ˆìƒ
    3. ì•„ì‹œì•„ ì‹ í¥êµ­ > ìœ ëŸ½ ì‹ í¥êµ­ > ê¸€ë¡œë²Œ ìˆœìœ¼ë¡œ ì¸í”Œë ˆì´ì…˜ ìˆ˜ì¤€
- ì£¼ì˜: 2025ë…„ ë¯¸êµ­ì˜ ì •ì±… ë³€í™”ê°€ ì£¼ìš”êµ­ ê²½ì œì— ì˜í–¥ ê°€ëŠ¥
```

#### ì£¼ìš”êµ­ ê²½ì œì„±ì¥ë¥  ì „ë§ ì°¨íŠ¸
![GDP Chart](examples/crop_chart_gdp.jpg)

**VLM í•´ì„ ê²°ê³¼:**
```
- ìš”ì•½: 2025ë…„ ê¸€ë¡œë²Œ ê²½ì œ ì„±ì¥ë¥ ì€ ì£¼ìš”êµ­ì˜ í†µìƒì •ì±… ë³€í™” ëŒ€ì‘ì— ë”°ë¼ 
       ì°¨ë³„í™”ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.
- í•µì‹¬:
    - ì¤‘êµ­: 5.2% â†’ 4.8% â†’ 4.5% (í•˜ë½ ì¶”ì„¸)
    - ë¯¸êµ­: 2.9% â†’ 2.8% â†’ 2.2%
    - í•œêµ­: 1.4% â†’ 2.2% â†’ 2.0%
- ì£¼ì˜: êµ­ê°€ë³„ ê²½ì œì„±ì¥ ì „ë§ì¹˜ì— í° ì°¨ì´ ì¡´ì¬
```

### ìµœì¢… Markdown ì¶œë ¥ (ì¼ë¶€)

```markdown
# Parsed Document

## Page 8

ê¸€ë¡œë²Œ ê²½ì œ â€” '25ë…„ ê¸€ë¡œë²Œ ì €ì„±ì¥Â·ì¸í”Œë ˆ í•˜í–¥ ì•ˆì •í™” êµ­ë©´ ì† ë¯¸êµ­ ì˜ˆì™¸ì£¼ì˜

'24ë…„ ì—°ì´ˆ ì „ë§ ëŒ€ë¹„ ë¯¸êµ­ê³¼ ì¤‘êµ­ ê²½ì œ ê±´ì¡°í•œ ì„±ì¥ì„¸ ì‹œí˜„í•˜ë©´ ì „ë°˜ì ìœ¼ë¡œ 
ì¸í”Œë ˆì´ì…˜ í•˜í–¥ ì•ˆì •í™”. '25ë…„ ë¯¸êµ­ ì˜ˆì™¸ì£¼ì˜ê°€ ì˜ˆìƒë˜ëŠ” ë°˜ë©´ ì£¼ìš”êµ­ ê²½ì œëŠ” 
ê¸€ë¡œë²Œ ë¬´ì—­í™˜ê²½ ë³€í™”ì™€ í†µí™”ì •ì±… ë¶ˆí™•ì‹¤ì„±ì— ëŒ€í•œ ëŒ€ì‘ë ¥ì— ë”°ë¥¸ ì°¨ë³„í™” ì „ë§

## ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ ì¶”ì´ ë° ì „ë§

![figure](crops/page_0008_elem_005.jpg)

**ì´ë¯¸ì§€ í•´ì„:**
- ìš”ì•½: ê¸€ë¡œë²Œ ì¸í”Œë ˆì´ì…˜ì€ 2022ë…„ ì •ì ì„ ì°ì€ í›„ ë‘”í™” ì¶”ì„¸...
- í•µì‹¬: ...
- ì£¼ì˜: ...
```

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì»´í¬ë„ŒíŠ¸ ê´€ê³„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ollamaparser                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Input Layer:                                                 â”‚
â”‚  â”œâ”€ pdf_render.py      â”€â”€â–º Pages â†’ Images                    â”‚
â”‚  â”œâ”€ detectors.py       â”€â”€â–º Layout Detection                  â”‚
â”‚  â””â”€ detection_filter.py â”€â”€â–º Filter & Clean                   â”‚
â”‚                                                                â”‚
â”‚  Processing Layer:                                            â”‚
â”‚  â”œâ”€ layout_order.py     â”€â”€â–º Reading Order (K-means)          â”‚
â”‚  â”œâ”€ ocr_vlm.py          â”€â”€â–º Task Execution (Parallel/Seq)   â”‚
â”‚  â””â”€ providers/          â”€â”€â–º Ollama Integration               â”‚
â”‚                                                                â”‚
â”‚  Output Layer:                                                â”‚
â”‚  â”œâ”€ text_clean.py       â”€â”€â–º Clean Text                       â”‚
â”‚  â”œâ”€ markdown_writer.py  â”€â”€â–º Generate Markdown               â”‚
â”‚  â””â”€ metadata.py         â”€â”€â–º Generate Metadata               â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

```
PDF File
  â†“ [pdf_render.py]
  â””â”€â†’ PageAsset[] {image, text, size}
       â†“ [detectors.py]
       â””â”€â†’ DetectedElement[] {bbox, type, confidence}
            â†“ [detection_filter.py]
            â””â”€â†’ Filtered Elements {confidence > threshold}
                 â†“ [layout_order.py]
                 â””â”€â†’ Sorted Elements {reading order}
                      â†“ [ocr_vlm.py]
                      â”œâ”€â†’ OCR Results {text}
                      â””â”€â†’ VLM Results {interpretation}
                           â†“ [text_clean.py]
                           â””â”€â†’ Cleaned Text
                                â†“ [markdown_writer.py]
                                â””â”€â†’ out.md, out.meta.json
```

---

## ğŸ“ ëª¨ë“ˆë³„ ìƒì„¸ ì„¤ëª…

### 1ï¸âƒ£ í•µì‹¬ íƒ€ì… ì •ì˜

| íŒŒì¼ | ì—­í•  |
|------|------|
| `types.py` | `PageAsset` â€” ë Œë”ë§ëœ í˜ì´ì§€ (ì´ë¯¸ì§€ ê²½ë¡œ, í¬ê¸°, í…ìŠ¤íŠ¸) |
| `layout_types.py` | `BBox`, `DetectedElement` â€” ê°ì§€ ê²°ê³¼ (ì¢Œí‘œ, íƒ€ì…, ì‹ ë¢°ë„) |

### 2ï¸âƒ£ PDF ì²˜ë¦¬

| íŒŒì¼ | ì—­í•  | ê¸°ëŠ¥ |
|------|------|------|
| `pdf_render.py` | ë Œë”ë§ | PDFium ê¸°ë°˜ ê³ í•´ìƒë„ ì´ë¯¸ì§€ ë³€í™˜ |

**í”„ë¡œì„¸ìŠ¤:**
```python
render_pdf_pages(pdf_path, dpi=150)
â”œâ”€ ê° í˜ì´ì§€ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
â”œâ”€ í…ìŠ¤íŠ¸ ë ˆì´ì–´ ì¶”ì¶œ (ê°€ëŠ¥í•œ ê²½ìš°)
â””â”€ PageAsset[] ë°˜í™˜
```

### 3ï¸âƒ£ ë ˆì´ì•„ì›ƒ ê°ì§€

| íŒŒì¼ | ì—­í•  | ê¸°ëŠ¥ |
|------|------|------|
| `detectors.py` | ê°ì§€ | DocLayout-YOLO ê¸°ë°˜ ìš”ì†Œ ê°ì§€ |
| `detection_filter.py` | í•„í„°ë§ | IoU ì¤‘ë³µ ì œê±°, ì‹ ë¢°ë„ í•„í„°ë§ |

**í•„í„°ë§ ì•Œê³ ë¦¬ì¦˜:**
```python
1. ì‹ ë¢°ë„ í•„í„°ë§ (confidence < threshold ì œê±°)
2. IoU ê¸°ë°˜ ì¤‘ë³µ ì œê±° (ê²¹ì¹¨ > threshold ì‹œ ë†’ì€ ì‹ ë¢°ë„ë§Œ ìœ ì§€)
3. ì£¼ë³€ ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ (VLM ì…ë ¥ìš©)
```

### 4ï¸âƒ£ ì½ê¸° ìˆœì„œ ì¶”ë¡ 

| íŒŒì¼ | ì—­í•  |
|------|------|
| `layout_order.py` | K-means ê¸°ë°˜ í–‰ í´ëŸ¬ìŠ¤í„°ë§ ë° ìˆœì„œ ê²°ì • |

**ì•Œê³ ë¦¬ì¦˜:**
```
1ë‹¨ê³„: Yì¢Œí‘œ â†’ K-means í´ëŸ¬ìŠ¤í„°ë§ (í–‰ ê·¸ë£¹í™”)
2ë‹¨ê³„: ê° í–‰ ë‚´ Xì¢Œí‘œ ì •ë ¬ (ì¢Œâ†’ìš°)
3ë‹¨ê³„: í–‰ ê°„ ìˆœì„œ í™•ì • (ìœ„â†’ì•„ë˜)
```

### 5ï¸âƒ£ OCR/VLM ì‹¤í–‰

| íŒŒì¼ | ì—­í•  |
|------|------|
| `ocr_vlm.py` | TaskExecutor â€” ë³‘ë ¬/ìˆœì°¨ ì‘ì—… ì‹¤í–‰ |

**ì‹¤í–‰ ëª¨ë“œ:**
```python
- execute_parallel()  â”€â”€â–º ëª¨ë“  ì‘ì—… ë™ì‹œ ì‹¤í–‰ (ë¹ ë¦„)
- execute_sequential() â”€â”€â–º OCRâ†’VLM ìˆœì°¨ (ë©”ëª¨ë¦¬ íš¨ìœ¨)
- execute_interleaved() â”€â”€â–º ìš”ì†Œë³„ ìˆœì°¨ (ê· í˜•)
```

### 6ï¸âƒ£ ì œê³µì (Providers)

| íŒŒì¼ | ì—­í•  |
|------|------|
| `providers/base.py` | Protocol ì •ì˜ (OCRModel, VisionLanguageModel) |
| `providers/ollama/client.py` | Ollama HTTP í´ë¼ì´ì–¸íŠ¸ |
| `providers/ollama/ocr.py` | OCR êµ¬í˜„ (DeepSeek-OCR ì§€ì›) |
| `providers/ollama/vlm.py` | VLM êµ¬í˜„ (Gemma3/Qwen3-VL ì§€ì›) |

**Ollama í†µì‹ :**
```
Python Client â†’ HTTP /api/generate â†’ Ollama Server
                                    â”œâ”€ deepseek-ocr (OCR_MODEL)
                                    â”œâ”€ gemma3:27b (VLM_MODEL)
                                    â””â”€ qwen3-vl:30b (VLM_MODEL)
```

**ëª¨ë¸ êµ¬ì„±:**
- `OCR_MODEL` í™˜ê²½ ë³€ìˆ˜ë¡œ OCR ëª¨ë¸ ë³€ê²½ ê°€ëŠ¥
- `VLM_MODEL` í™˜ê²½ ë³€ìˆ˜ë¡œ VLM ëª¨ë¸ ë³€ê²½ ê°€ëŠ¥
- `.env` íŒŒì¼ì—ì„œ ê¸°ë³¸ê°’ ì„¤ì • ê°€ëŠ¥

### 7ï¸âƒ£ í›„ì²˜ë¦¬

| íŒŒì¼ | ì—­í•  |
|------|------|
| `text_clean.py` | í…ìŠ¤íŠ¸ ì •ì œ (í• ë£¨ì‹œë„¤ì´ì…˜ í•„í„°, HTMLâ†’MD) |
| `quality_check.py` | í’ˆì§ˆ ë¶„ì„ (ê²¹ì¹¨, ë¹ˆ ì˜ì—­ ë“±) |

### 8ï¸âƒ£ ì¶œë ¥ ìƒì„±

| íŒŒì¼ | ì—­í•  |
|------|------|
| `markdown_writer.py` | Markdown ë¹Œë” (final/debug ìŠ¤íƒ€ì¼) |
| `metadata.py` | ë©”íƒ€ë°ì´í„° JSON ìƒì„± |

---

## ğŸ”§ ì„¤ì¹˜

```bash
# ê¸°ë³¸ ì„¤ì¹˜
uv sync

# DocLayout-YOLO í¬í•¨ ì„¤ì¹˜
uv sync --extra detector
```

### ìš”êµ¬ì‚¬í•­

- Python 3.10+
- [Ollama](https://ollama.ai/) (ë¡œì»¬ LLM ì„œë²„)

```bash
# Ollama ëª¨ë¸ ë‹¤ìš´ë¡œë“œ
ollama pull deepseek-ocr
ollama pull gemma3:27b
# ë˜ëŠ”
ollama pull qwen3-vl:30b
```

### í™˜ê²½ ì„¤ì • (.env)

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ëª¨ë¸ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
# .env íŒŒì¼ ì˜ˆì‹œ
OCR_MODEL=deepseek-ocr:latest
VLM_MODEL=gemma3:27b
OLLAMA_HOST=http://localhost:11434
```

**í™˜ê²½ ë³€ìˆ˜:**
- `OCR_MODEL`: OCRì— ì‚¬ìš©í•  ëª¨ë¸ (ê¸°ë³¸ê°’: `deepseek-ocr:latest`)
- `VLM_MODEL`: VLMì— ì‚¬ìš©í•  ëª¨ë¸ (ê¸°ë³¸ê°’: `gemma3:27b`)
- `OLLAMA_HOST`: Ollama ì„œë²„ ì£¼ì†Œ (ê¸°ë³¸ê°’: `http://localhost:11434`)

**ëª¨ë¸ ë³€ê²½ ì˜ˆì‹œ:**

```bash
# ë‹¤ë¥¸ OCR ëª¨ë¸ ì‚¬ìš©
OCR_MODEL=custom-ocr:v2 uv run ollamaparser-parse --pdf document.pdf --out_dir ./output

# ë‹¤ë¥¸ VLM ëª¨ë¸ ì‚¬ìš©
VLM_MODEL=qwen3-vl:30b uv run ollamaparser-parse --pdf document.pdf --out_dir ./output

# ì›ê²© Ollama ì„œë²„ ì‚¬ìš©
OLLAMA_HOST=http://192.168.1.100:11434 uv run ollamaparser-parse --pdf document.pdf --out_dir ./output
```

---

## ğŸ’» ì‚¬ìš©ë²•

### ê¸°ë³¸ ì‹¤í–‰

```bash
uv run ollamaparser-parse \
  --pdf "document.pdf" \
  --out_dir ./output \
  --detector doclayout-yolo \
  --yolo-weights "juliozhao/DocLayout-YOLO-DocStructBench" \
  --yolo-from-pretrained \
  --ocr-provider deepseek-ollama \
  --ocr-scope elements \
  --vlm-provider ollama-vlm \
  --vlm-scope visuals \
  --execution-mode parallel
```

### ì£¼ìš” ì˜µì…˜

#### Detector ì˜µì…˜
| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--detector` | `doclayout-yolo` / `pdfium-text` / `fallback` |
| `--yolo-weights` | YOLO ê°€ì¤‘ì¹˜ ê²½ë¡œ ë˜ëŠ” HF repo_id |
| `--yolo-from-pretrained` | HuggingFaceì—ì„œ ê°€ì¤‘ì¹˜ ë‹¤ìš´ë¡œë“œ |
| `--save-detections` | ê°ì§€ ê²°ê³¼ ì´ë¯¸ì§€/JSON ì €ì¥ |

#### OCR ì˜µì…˜
| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--ocr-provider` | `none` / `deepseek-ollama` |
| `--ocr-scope` | `none` / `page` / `elements` |
| `--ocr-mode` | `markdown` / `free` |
| `--figure-ocr` | ê·¸ë¦¼ ì˜ì—­ë„ OCR ìˆ˜í–‰ |

#### VLM ì˜µì…˜
| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--vlm-provider` | `none` / `ollama-vlm` |
| `--vlm-scope` | `none` / `page` / `visuals` |
| `--ollama-vlm-model` | `gemma3:27b` / `qwen3-vl:30b` |
| `--vlm-use-image` | VLMì— ì´ë¯¸ì§€ ì „ë‹¬ |
| `--figure-vlm` | ê·¸ë¦¼ ì˜ì—­ VLM í•´ì„ |

#### ì‹¤í–‰ ëª¨ë“œ
| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--execution-mode` | `grouped` / `interleaved` / `parallel` |
| `--parallel-workers` | ë³‘ë ¬ ì›Œì»¤ ìˆ˜ (ê¸°ë³¸: 4) |

#### ì¶œë ¥ ì˜µì…˜
| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--md-style` | `final` (ê¹”ë”) / `debug` (bbox í¬í•¨) |
| `--metadata/--no-metadata` | ë©”íƒ€ë°ì´í„° JSON ìƒì„± ì—¬ë¶€ |

---

## ğŸ“‚ ì¶œë ¥ êµ¬ì¡°

```
output/
â”œâ”€â”€ pages/                    # ë Œë”ë§ëœ í˜ì´ì§€ ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ page_0001.png
â”‚   â””â”€â”€ page_0002.png
â”œâ”€â”€ crops/                    # VLMìš© í¬ë¡­ ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ page_0001_elem_005.jpg
â”‚   â””â”€â”€ page_0002_elem_012.jpg
â”œâ”€â”€ detections/               # ê°ì§€ ê²°ê³¼ (--save-detections)
â”‚   â”œâ”€â”€ page_0001.jpg         # ë°”ìš´ë”©ë°•ìŠ¤ ì˜¤ë²„ë ˆì´
â”‚   â””â”€â”€ page_0001.json        # ê°ì§€ëœ ìš”ì†Œ JSON
â”œâ”€â”€ out.md                    # ìµœì¢… Markdown ì¶œë ¥
â”œâ”€â”€ out.meta.json             # ë©”íƒ€ë°ì´í„° (ì„ íƒ)
â””â”€â”€ run.log                   # ì‹¤í–‰ ë¡œê·¸
```

---

## ğŸ“¦ ì˜ì¡´ì„±

### Core
- `pypdfium2` - PDF ë Œë”ë§
- `pillow` - ì´ë¯¸ì§€ ì²˜ë¦¬
- `typer` - CLI í”„ë ˆì„ì›Œí¬
- `pydantic` - ë°ì´í„° ê²€ì¦
- `requests` - Ollama API í˜¸ì¶œ
- `scikit-learn` - K-means í´ëŸ¬ìŠ¤í„°ë§

### Optional (detector)
- `doclayout-yolo` - DocLayout-YOLO SDK
- `huggingface-hub` - ëª¨ë¸ ë‹¤ìš´ë¡œë“œ

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License
# ollama-document-parser
